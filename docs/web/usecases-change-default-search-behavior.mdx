---
title: Change Default Search Behavior
description: Geocortex Web - Learn how to configure Geocortex Web to change the default search behavior
---

import useBaseUrl from "@docusaurus/useBaseUrl";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import UseCaseContainer from "../../src/components/UseCaseContainer";
import UseCaseCard from "../../src/components/UseCaseCard";
import PrereqsCustomCodeSnippet from "./snippets/prereqs-custom-code.mdx";

Geocortex Web comes with search functionality out of the box. The default behavior will return results from all enabled layers that can be searched on the map. But what if you want to replace the functionality with your own search? Or filter the results returned by the default search? [Geocortex Web Designer](https://apps.geocortex.com/webviewer/designer/) can't accomplish this, but it can be accomplished by leveraging [Geocortex Workflow](https://apps.geocortex.com/workflow/designer/) and editing the [app config](concepts-app-config.mdx).

## What you're Building

We will modify the default search behavior of the built in search component on the Fire Hydrants layer to have an optional filter that will only show fire hydrants without a hydrants survey.

## Prerequisites

<PrereqsCustomCodeSnippet />

## Initial Set up

Load Geocortex Web with the following layout and app json. You should see a simple application with one layer, Fire Hydrants, which has a related table Fire Hydrant Surveys.

<Tabs
  defaultValue="config"
  values={[
    { label: "App Config", value: "config" },
    { label: "Layout", value: "layout" },
  ]}>
<TabItem value="config">

```json title="app/app.json"
{
    "items": [
        {
            "id": "default",
            "layerExtensions": [
                "item://layer-extension/victoria-fire-hydrants"
            ],
            "tableExtensions": ["item://table-extension/fire-hydrants-table"],
            "onClick": [
                "geometry.add-pixel-tolerance",
                "tasks.identify",
                "results.display-details"
            ],
            "webMap": {
                "version": "2.8",
                "operationalLayers": [
                    {
                        "id": "fire_hydrants",
                        "layerType": "ArcGISFeatureLayer",
                        "url": "https://services.arcgis.com/p3UBboyC0NH1uCie/ArcGIS/rest/services/Victoria_Fire_Hydrants/FeatureServer/0",
                        "visibility": true,
                        "opacity": 1,
                        "title": "Fire Hydrants",
                        "popupInfo": {
                            "title": "{HYDRANT_NUM}",
                            "description": "This fire hydrant is currently {STATUS} and has a flow of {FLOW}.",
                            "showAttachments": true,
                            "relatedRecordsInfo": {
                                "showRelatedRecords": true
                            },
                            "fieldInfos": [
                                {
                                    "fieldName": "JURISDICTION",
                                    "label": "Jurisdiction",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "SYSTEM",
                                    "label": "System",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "COMMENTS",
                                    "label": "Comments",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "STATUS",
                                    "label": "Status",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "DATA_SRC",
                                    "label": "Data Source",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "TYPE",
                                    "label": "Type",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "FLOW",
                                    "label": "Flow",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "MAIN_ID",
                                    "label": "Main ID",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "LATERAL_ID",
                                    "label": "Lateral ID",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "HYDRANT_NUM",
                                    "label": "Hydrant Number",
                                    "isEditable": false,
                                    "visible": true
                                },
                                {
                                    "fieldName": "MANUFACTURER",
                                    "label": "Manufacturer",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "OWNER",
                                    "label": "Owner",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "ASSET_ID",
                                    "label": "Asset ID",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "SURVEY_REQ",
                                    "label": "Survey Requested",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "INSTALL_DATE",
                                    "label": "Installation Date",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "LAST_FLUSHED",
                                    "label": "Last Flushed",
                                    "isEditable": true,
                                    "visible": true
                                },
                                {
                                    "fieldName": "GlobalID",
                                    "label": "Global ID",
                                    "isEditable": false,
                                    "visible": false
                                },
                                {
                                    "fieldName": "CreationDate",
                                    "label": "Creation Date",
                                    "isEditable": false,
                                    "visible": false
                                },
                                {
                                    "fieldName": "Creator",
                                    "label": "Creator",
                                    "isEditable": false,
                                    "visible": false
                                },
                                {
                                    "fieldName": "EditDate",
                                    "label": "Edit Date",
                                    "isEditable": false,
                                    "visible": false
                                },
                                {
                                    "fieldName": "Editor",
                                    "label": "Editor",
                                    "isEditable": false,
                                    "visible": false
                                }
                            ],
                            "popupElements": [
                                {
                                    "type": "fields"
                                },
                                {
                                    "type": "attachments"
                                }
                            ]
                        }
                    }
                ],
                "baseMap": {
                    "baseMapLayers": [
                        {
                            "id": "topo",
                            "layerType": "ArcGISTiledMapServiceLayer",
                            "url": "http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
                            "title": "Topographic"
                        }
                    ]
                },
                "tables": [
                    {
                        "url": "https://services.arcgis.com/p3UBboyC0NH1uCie/ArcGIS/rest/services/Victoria_Fire_Hydrants/FeatureServer/6",
                        "id": "fire_hydrants_table",
                        "title": "Fire Hydrants - Hydrant Surveys",
                        "popupInfo": {
                            "title": "Hydrant Surveys: {HYDRANT_NUM}",
                            "fieldInfos": [
                                {
                                    "fieldName": "OBJECTID_1",
                                    "label": "OBJECTID_1",
                                    "isEditable": false,
                                    "tooltip": "",
                                    "visible": false,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "HYDRANT_NUM",
                                    "label": "Hydrant Number",
                                    "isEditable": true,
                                    "tooltip": "",
                                    "visible": true,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "RESULT",
                                    "label": "Result",
                                    "isEditable": true,
                                    "tooltip": "",
                                    "visible": true,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "SURVEYOR",
                                    "label": "Surveyor",
                                    "isEditable": true,
                                    "tooltip": "",
                                    "visible": true,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "SURVEY_DATE",
                                    "label": "Survey Date",
                                    "isEditable": true,
                                    "tooltip": "",
                                    "visible": true,
                                    "stringFieldOption": "textbox",
                                    "format": {
                                        "dateFormat": "shortDateShortTime"
                                    }
                                },
                                {
                                    "fieldName": "COMMENTS",
                                    "label": "Comments",
                                    "isEditable": true,
                                    "tooltip": "",
                                    "visible": true,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "created_user",
                                    "label": "created_user",
                                    "isEditable": false,
                                    "tooltip": "",
                                    "visible": false,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "created_date",
                                    "label": "created_date",
                                    "isEditable": false,
                                    "tooltip": "",
                                    "visible": false,
                                    "stringFieldOption": "textbox",
                                    "format": {
                                        "dateFormat": "shortDateShortTime"
                                    }
                                },
                                {
                                    "fieldName": "last_edited_user",
                                    "label": "last_edited_user",
                                    "isEditable": false,
                                    "tooltip": "",
                                    "visible": false,
                                    "stringFieldOption": "textbox"
                                },
                                {
                                    "fieldName": "last_edited_date",
                                    "label": "last_edited_date",
                                    "isEditable": false,
                                    "tooltip": "",
                                    "visible": false,
                                    "stringFieldOption": "textbox",
                                    "format": {
                                        "dateFormat": "shortDateShortTime"
                                    }
                                }
                            ],
                            "description": null,
                            "showAttachments": true,
                            "mediaInfos": []
                        }
                    }
                ],
                "$initialViewpoint": {
                    "targetGeometry": {
                        "spatialReference": {
                            "wkid": 102100,
                            "latestWkid": 3857
                        },
                        "xmax": -13732997.567840427,
                        "xmin": -13733798.962308966,
                        "ymax": 6177644.453403971,
                        "ymin": 6177206.134819838
                    }
                }
            },
            "$type": "map-extension"
        },
        {
            "id": "results-list-config",
            "onFeatureClick": ["results.display-details"],
            "$type": "results"
        },
        {
            "id": "victoria-fire-hydrants",
            "iconUrl": "https://www.arcgis.com/sharing/rest/content/items/9087ae6c5b34483c84e3d9b475bc5bae/resources/symbols/resources/hydrants_icon.png",
            "layer": {
                "$ref": "fire_hydrants",
                "layerType": "ArcGISFeatureLayer"
            },
            "$type": "layer-extension"
        },
        {
            "id": "fire-hydrants-table",
            "table": {
                "$ref": {
                    "id": "fire_hydrants_table",
                    "title": "Fire Hydrants - Hydrant Surveys"
                }
            },
            "$type": "table-extension"
        },
        {
            "id": "search-config",
            "$type": "search"
        }
    ]
}
```

</TabItem>
<TabItem value="layout">

```xml title="app/layout.xml"
<?xml version="1.0" encoding="UTF-8"?>
<layout xmlns="https://geocortex.com/layout/v1">
  <split resizable="true">
    <panel show-close-button="false" width="26">
      <layer-list models="#map-primary"/>
      <results-list active="false" config="results-list-config"/>
      <feature-details active="true" />
      <workflow active="false" id="workflow-area"/>
    </panel>
    <stack>
      <map id="map-primary" config="default">
        <search config="search-config" slot="top-right"/>
      </map>
    </stack>
  </split>
</layout>
```

</TabItem>
</Tabs>

Search for the text `active`. You should see some number of results. If you look at the details for some of the Fire Hydrants, you'll notice some have Fire Hydrant Surveys and some don't. We will build a workflow that will only return the Fire Hydrants without a related survey when you search for `active filter:nosurveys`.

## Set up a Workflow to Run on Search

The first thing we need to do is override the default search behavior. We can do this by [editing the default behavior](usecases-change-default-behavior.mdx) for the "Search" component in the app config. The default behavior for search is a command chain that runs `tasks.search` and then `results.display`, as seen in the [api](api-components.mdx#search).

```json
{
    "items": [
        ...
        {
            "id": "search-config",
            // highlight-next-line
            "onSearch": ["tasks.search", "results.display"],
            "$type": "search"
        }
        ...
    ]
}
```

First, we are going to replace the command chain with a `workflow.run` command that replicates this behavior.

1. Open up [Geocortex Workflow Designer](https://apps.geocortex.com/workflow/designer/) and create and save a new workflow.
2. Add an "Alert" activity as a test.
3. Copy the ID of the the workflow from the URL

<img
    src={useBaseUrl("img/custom-search-workflow-url.png")}
    alt="Workflow URL with ID"
/>

4. Add the workflow as an app item to your app config.

```json
{
    "items": [
        ...
        {
            "$type": "workflow",
            "id": "filter-search-workflow",
            "title": "Filter Search Workflow",
            "commandArgumentInput": "context",
            "portalItem": "<your-workflow-id-here>"
        },
        ...
    ]
}
```

5. Next, configure the `onSearch` property of the Search Component in the app config to run the workflow.

```json
{
    "items": [
        ...
        {
            "id": "search-config",
            "onSearch": "workflow.run-filter-search-workflow",
            "$type": "search"
        }
        ...
    ]
}
```

6. Run the app and test your workflow. You should see your alert pop up when you try to search for something.

<img
    src={useBaseUrl("img/custom-search-workflow-alert.png")}
    alt="Search Workflow with Alert"
/>

7. Open up your Workflow in the Workflow Designer again. The default behavior we just overode can be recreated with the use of [RunCommand](https://docs.geocortex.com/workflow/latest/help/Default.htm#wf5/help/activities/run-command.htm%3FTocPath%3DActivities%7CActivity%2520Reference%7C_____169) and [RunOperation](https://docs.geocortex.com/workflow/latest/help/Default.htm#wf5/help/activities/run-operation.htm%3FTocPath%3DActivities%7CActivity%2520Reference%7C_____173) activities. `tasks.search` is an operation, so it needs a RunOperation Activity, and `results.display` is a command so it needs a RunCommand Activity. Chain these two activities together, passing the [workflow context](https://docs.geocortex.com/webviewer/latest/admin-help/Default.htm#gwv/add-a-workflow-to-an-app.htm#use-the-menu-context-as-a-workflow-input%3FTocPath%3DConfiguration%7CAdd%2520a%2520Workflow%2520to%2520an%2520App%7C_____4) to `tasks.search` and then passing the output of that operation to `results.display`.

<img
    src={useBaseUrl("img/custom-search-workflow-recreated.png")}
    alt="Search Workflow with Original Operations"
/>

7. Save the workflow and reload the application. Test the search functionality and ensure it works as it originally did.

:::tip
Check out [Change Default Application Behavior](usecases-change-default-behavior.mdx) for more ways to override default behavior like search.
:::

## Extend the Workflow to Filter the Results.

At this point, you can choose to extend the search behavior with Geocortex Workflow in whatever way is appropiate for your usecase. You could execute a different search for external results and add them to the set of results displayed, filter out specific results from the search, or replace the default search operation with an entirely different search operation. For this example, a workflow was created which checks the incoming search text for the text "filter:nosurvey" and then filters results to Fire Hydrants without a survey. The workflow [can be found here](https://latitudegeo.maps.arcgis.com/home/item.html?id=bc7647d4485743e98ea42cd69ee4aa66).
